---
import MainLayout from "../layouts/main.astro";
import { pageTitle, pageDescription } from "../consts";
import Card from "../components/Card.svelte";
import StatsComponent from "../components/Stats.astro";
import Toast from "../components/Toast.svelte";

import { getCurrentSuiBalance, getLiSUIRatio } from "../client/lisuify";
import { getValidatorAPY } from "../client/sui";
import type { Stats } from "../types";

const totalSuiStaking = await getCurrentSuiBalance();
const liSuiRatio = await getLiSUIRatio();
const validatorApy = await getValidatorAPY();
const averageApy =
  (validatorApy.apys.reduce((sum, a) => {
    return sum + a.apy;
  }, 0) /
    validatorApy.apys.length) *
  100;
const stats: Stats = {
  liSuiRatio: liSuiRatio,
  totalSuiStaking: totalSuiStaking,
  averageApy: averageApy,
};
---

<MainLayout title={pageTitle} description={pageDescription} isWallet={true}>
  <div
    class="container mx-auto flex flex-col justify-items-center items-center gap-4"
  >
    <StatsComponent stats={stats} />
    <Card stats={stats} client:only />
    <Toast client:only />
  </div>
</MainLayout>
